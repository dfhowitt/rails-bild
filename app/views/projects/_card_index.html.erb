<div class="projects-card-holder w-800">
  <h2>We found <%= pluralize(@projects.count, 'project') %> near "<%= @query %>":</h2>

  <!-- START of testing unavailable date funcationality -->
  <p> unconfirmed: <% @unconfirmed_placement_dates.each do |date| %>
                 <%= date %>
               <% end %>
  </p>
  <p> confirmed: <% @confirmed_placement_dates.each do |date| %>
                 <%= date %>
               <% end %>
  </p>

  <p> user qualifications: <% current_user.qualifications.each do |qualification| %>
    <%= qualification.name %>
    <% end %>
  </p>
  <!-- END of testing -->

  <% unless @results %>
    <div class="">
      <p class="no-results"><i class="fas fa-times text-danger"></i>  No projects found near "<%= @query %>"</p>
    </div>
    <h2>We suggest:</h2>
  <% end %>

  <% @projects.each do |project| %>
    <div class="project-card bg-info d-flex">

      <div class="project-card-photo">
        <%= cl_image_tag project.site.photo.key, width: 120, height: 120, crop: :fit%>
      </div>

      <div class="project-card-body">

        <div class="project-card-details-top">

          <div class="project-card-project-title">
            <h2><%= link_to project.job_type, project_path(project) %> - <small><i> <%= Geocoder::Calculations.distance_between(@query_coords, [project.site.latitude, project.site.longitude]).round(1)%> km away </i></small></h2>
          </div>

          <div class="project-conflict">
            <% if check_project_for_application_overlap(project) %>
              <p style="color:red"> Project overlaps with open applications</p>
            <% end %>
          </div>

        </div>

        <div class="project-card-details-center">

          <div class="project-card-project-dates">
            <h6><strong>Start: </strong> <%= project.start_date.strftime('%a - %B %-d, %Y') %> </h6>
            <h6><strong>End: </strong> <%=  project.end_date.strftime('%a - %B %-d, %Y') %> </h6>
          </div>

          <div class="project-card-project-pay-info">
            <h5 class="mb-0"><%= number_to_currency(project.wage, unit: "Â£", precision: 0) %> per hour </h5>
            <p class="mb-0">Spots remaining: <%= project.capacity - project.placements.where(confirmed: true).count %></p>
          </div>

          <% if check_project_qualification_requirements(project) %>
            <div class="apply-button">
              <% if project.autoconfirm == true %>
                <%= simple_form_for [project, @placement], remote: true do |f| %>
                  <%= f.submit "Instant Confirm", class:"btn btn-primary" %>
                <% end %>
              <% else %>
                <%= simple_form_for [project, @placement], remote: true do |f| %>
                  <%= f.submit "Submit Application", class:"btn btn-primary" %>
                <% end %>
              <% end %>
            </div>
          <% else %>
            <div class="innactive-apply-button">
              <i class="btn btn-warning">Qualification Needed</i>
            </div>
          <% end %>

        </div>

        <div class="project-card-details-bottom">

          <div class="project-card-project-address">
            <%= project.site.location %>
          </div>

          <div class="project-card-qualifications">
            <p><% project.project_qualifications.each_with_index do |pq, i| %>
              <% if i != project.project_qualifications.size - 1 %>
                <%= pq.qualification.name %> +
              <% else %>
                <%= pq.qualification.name %>
              <% end %>
            <% end %>
            </p>
          </div>

        </div>

      </div>

    </div>
  <% end %>

</div>
